<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Revision: 13397 $ : Generated by SACT ver.1.0.0 at 2013/10/16 20:46:53 -->
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Stg">
    <!-- ================================================== -->
    <!-- Domainの別名定義 -->
    <!-- ================================================== -->
    <!-- Domain -->   
    <typeAlias alias="WS4501TtStgInstrByStgInstrNoCriteriaDomain"
        type="com.globaldenso.eca0027.core.business.domain.criteria.WS4501TtStgInstrByStgInstrNoCriteriaDomain" />
    <typeAlias alias="WS4501TtPltzByConditionCriteriaDomain"
        type="com.globaldenso.eca0027.core.business.domain.criteria.WS4501TtPltzByConditionCriteriaDomain" />   
    <typeAlias alias="WS4501TtPltzByMainMarkCriteriaDomain"
        type="com.globaldenso.eca0027.core.business.domain.criteria.WS4501TtPltzByMainMarkCriteriaDomain" />   
    <typeAlias alias="WS4501TtXpltzByXMainMarkCriteriaDomain"
        type="com.globaldenso.eca0027.core.business.domain.criteria.WS4501TtXpltzByXMainMarkCriteriaDomain" />     
    <typeAlias alias="ttPltzUpdateDomain"
        type="com.globaldenso.eca0027.core.auto.business.domain.TtPltzDomain" />     
                                       
    <!-- ================================================== -->
    <!-- 検索結果をMapで受け取る                            -->
    <!-- ================================================== -->
    <!-- RelativeWeekCalenderFile -->
    <resultMap id="ECA0027_WS_4501Domain_SearchTtStgInstrByCondition" class="com.globaldenso.eca0027.core.business.domain.ECA0027_WS_4501Domain">
        <result property="stgInstrNo" column="STG_INSTR_NO" />
        <result property="stgInstrStatus" column="STG_INSTR_STATUS" />
        <result property="mainMark" column="MAIN_MARK" />
        
    </resultMap>
    <resultMap id="ECA0027_WS_4501Domain_LockTtPltzByConditionNoWait" class="com.globaldenso.eca0027.core.business.domain.ECA0027_WS_4501Domain">
        <result property="mainMark" column="MAIN_MARK" />
        <result property="pltzStatus" column="PLTZ_STATUS" />
        <result property="customTimingTyp" column="CUSTOM_TIMING_TYP" />
        <result property="comUpdateTimestamp" column="COM_UPDATE_TIMESTAMP" />
        
    </resultMap>
    <resultMap id="ECA0027_WS_4501Domain_SearchTtPltzByKeys" class="com.globaldenso.eca0027.core.business.domain.ECA0027_WS_4501Domain"> 
        <result property="mainMark" column="MAIN_MARK" />
        <result property="weightUnit" column="WEIGHT_UNIT" />
        <result property="grossWeight" column="GROSS_WEIGHT" />
        <result property="volumeUnit" column="VOLUME_UNIT" />
        <result property="volume" column="VOLUME" />
    </resultMap>
    <resultMap id="ECA0027_WS_4501Domain_SearchTtXpltzByKeys" class="com.globaldenso.eca0027.core.business.domain.ECA0027_WS_4501Domain">  
        <result property="xmainMark" column="XMAIN_MARK" />
        <result property="weightUnit" column="WEIGHT_UNIT" />
        <result property="grossWeight" column="GROSS_WEIGHT" />
        <result property="volumeUnit" column="VOLUME_UNIT" />
        <result property="volume" column="VOLUME" />
    </resultMap>

    <!-- ================================================== -->
    <!-- 実行SQL                                            -->
    <!-- ================================================== -->
    <!-- 検索(searchRelativeWeekCalenderFile) ================================================== -->
    <select id="SearchTtStgInstrByCondition" 
        resultMap="ECA0027_WS_4501Domain_SearchTtStgInstrByCondition" parameterClass="WS4501TtStgInstrByStgInstrNoCriteriaDomain">
        select /* SqlMap-Stg.SearchTtStgInstrByCondition */
            TT_STG_INSTR.STG_INSTR_NO,
            TT_STG_INSTR.STG_INSTR_STATUS,
            TT_PLTZ.MAIN_MARK 

        from
            TT_STG_INSTR,
            TT_PLTZ
        where
            TT_STG_INSTR.STG_INSTR_NO = TT_PLTZ.STG_INSTR_NO
            and TT_STG_INSTR.STG_INSTR_NO = #stgInstrNo# 
            order by MAIN_MARK desc
    </select>

    <select id="LockTtPltzByConditionNoWait" 
        resultMap="ECA0027_WS_4501Domain_LockTtPltzByConditionNoWait" parameterClass="WS4501TtPltzByConditionCriteriaDomain">
        select /* SqlMap-Stg.LockTtPltzByConditionNoWait */
            MAIN_MARK,
            PLTZ_STATUS,
            CUSTOM_TIMING_TYP, 
            COM_UPDATE_TIMESTAMP 
            from
                TT_PLTZ
            where
        <isNotEqual property="stgInstrNo" compareValue="">
                STG_INSTR_NO = #stgInstrNo#
        </isNotEqual>
        <isNotEqual property="xmainMark" compareValue="">
                XMAIN_MARK = #xmainMark# 
        </isNotEqual>
            order by MAIN_MARK 
            for update nowait
    </select>       


    
    <select id="SearchTtPltzByKeys" 
        resultMap="ECA0027_WS_4501Domain_SearchTtPltzByKeys" parameterClass="WS4501TtPltzByMainMarkCriteriaDomain">
        select /* SqlMap-Stg.SearchTtPltzByKeys */
            MAIN_MARK,
            WEIGHT_UNIT,
            GROSS_WEIGHT,
            VOLUME_UNIT,
            VOLUME 
        from
            TT_PLTZ
      
    <iterate property="mainMarkList" prepend=" WHERE MAIN_MARK IN" open="(" close=")" conjunction="," >
    #mainMarkList[].mainMark#
    </iterate>
    </select>
    
    
    <select id="SearchTtXpltzByKeys" 
        resultMap="ECA0027_WS_4501Domain_SearchTtXpltzByKeys" parameterClass="WS4501TtXpltzByXMainMarkCriteriaDomain">
        select /* SqlMap-Stg.SearchTtXpltzByKeys */
            XMAIN_MARK,
            WEIGHT_UNIT,
            GROSS_WEIGHT,
            VOLUME_UNIT,
            VOLUME 
        from
            TT_XPLTZ
    <iterate property="mainMarkList" prepend="WHERE XMAIN_MARK IN" open="(" close=")" conjunction="," >
    #mainMarkList[].mainMark#
    </iterate>
    </select>

    <!-- MGTNo.570 ADD -->
    <update id="UpdateStgInstrIncludedInStgAct" parameterClass="java.util.Map">
        update /* SqlMap-Stg.UpdateStgInstrIncludedInStgAct */
            TT_STG_INSTR T1
        set
                STG_ACT_NO = #stgActNo#
            ,   COM_UPDATE_FUNC_ID = #comUpdateFuncId#
            ,   COM_UPDATE_USER_ID = #comUpdateUserId#
            ,   COM_UPDATE_TIMESTAMP = SYSDATE
        where
            exists (
                select 'x'
                from TT_PLTZ T2
                where
                        T2.STG_INSTR_NO = T1.STG_INSTR_NO
                    and T2.STG_ACT_NO = #stgActNo#
            )
    </update>

</sqlMap>